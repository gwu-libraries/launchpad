{% extends "base.html" %}
{% load launchpad_extras humanize %}

{% block javascript_extra %}
<script src=""></script>
{% endblock %}

{% block content %}

<div class="libsite-container container">

    <section class="search row pagination">
        <form class="span12" action="{% url "search" %}" method="get">
            <input style="float: left; margin-right: 10px;" name="q" type="text"
            placeholder="Search" value="{{ q }}" size="60"></input>
            <ul>
                {% if prev_page_range %}
                <li><a href="{% url "search" %}?{{ prev_page_range }}">&#x00ab;</a></li>
                {% endif %}

                {% for n, q in page_range %}
                <li {% if n == page %}class="active"{% endif %}><a href="{% url "search" %}?{{q}}">{{ n }}</a></li>
                {% endfor %}

                {% if next_page_range %}
                <li><a href="{% url "search" %}?{{ next_page_range }}">&#x00bb;</a>
                {% endif %}
            </ul> 
        </form>
    </section>

    {% if active_facets %}
    <section id="active-facets">
      <ul>
        {% for facet in active_facets %}
        <li class="{{ facet.name }}">
          <a class="btn" title="remove {{ facet.value }} facet" href="{{ facet.remove_link }}">{{ facet.value }}<i class="fa fa-ellipsis-v"></i><i class="fa fa-times-circle"></i></a>
        </li>
        {% endfor %}
      </ul>
    </section>
    {% endif %}

    <div class="row">

    <section id="search-results" class="span8">

    {% if not search_results.results %}
    <p>
    We're sorry, no results were found for your search.
    </p>

    <p>
    Here are a few things you could try:
    <ul>
      <li>check your spelling</li>
      <li>try different keywords</li>
      <li>try more general keywords</li>
      <li>try fewer keywords</li>
    </ul>

    If you continue to have trouble please feel free to  
    <a href="http://library.gwu.edu/help/reference/ask-a-librarian">ask a
      librarian</a> for assistance.

    </p>
    {% endif %} 

    {% for doc in search_results.results %}
    <article id="{{ doc.id }}" class="search-result" itemscope itemtype="{{ doc.type }}">
        {% if doc.type == "Book" %}<img title="Book" class="item-type" src="{{ STATIC_URL }}img/book.png">{%endif %}
        {% if doc.type == "VideoObject" %}<img title="Video" class="item-type" src="{{ STATIC_URL }}img/video.png">{% endif %}
        {% if doc.type == "AudioObject" %}<img title="Audio" class="item-type" src="{{ STATIC_URL }}img/audio.png">{% endif %}
        {% if doc.type == "Map" %}<img title="Map" class="item-type" src="{{ STATIC_URL }}img/map.png">{% endif %}
        {% if doc.type == "Periodical" %}<img title="Periodical" class="item-type" src="{{ STATIC_URL }}img/periodical.png">{% endif %}
        {% if doc.type == "WebPage" %}<img title="Web Page" class="item-type" src="{{ STATIC_URL }}img/webpage.png">{% endif %}

        {% if doc.thumbnailUrl %}
        <a href="{{ doc.id }}">
            <img itemprop="image" class="cover-thumbnail" src={{ doc.thumbnailUrl }}>
        </a>
        {% endif %}

        {% if doc.alternateName %}
        <a href="{{ doc.id }}">
            <span itemprop="alterateName">{{ doc.alternateName }}</span>
        </a>
        {% if doc.author %}
        / 
        {% for author in doc.author %}
        {% if author.alternateName %}
        <span itemprop="author" itemtype="Person" itemscope>
            <span itemprop="alternateName">{{ author.alternateName }}</span>
            {% if forloop.last %}<span class="trailing-period">.</span>{% else %} ; {% endif %}
        </span>
        {% endif %}
        {% endfor %}
        {% endif %}
        {% endif %}

        <a href="{{ doc.id }}">
            <div class="search-result-title" itemprop="name">{{ doc.name }}</div>
        </a>

        {% if doc.author %}
        {% for author in doc.author %}
        <span itemprop="author" itemtype="Person" itemscope>
            <a href="{{ author.url }}" itemprop="name">{{ author.name }}</a>
            {% if forloop.last %}<span class="trailing-period">.</span>{% else %} ; {% endif %}
        </span>
        {% endfor %}
        {% endif %}

        {% if doc.bookEdition %}
        <br>
        <span itemprop="bookEdition">{{ doc.bookEdition }}</span>.
        {% endif %}

        <br>
        {% if doc.publisher %}
        <span itemprop="publisher" itemscope itemtype="Person">
            {% if doc.publishers.address %}
            <span itemprop="address">{{ doc.publisher.address }}</span> :
            {% endif %}
            <span itemprop="name">{{ doc.publisher.name }}</span>
        </span>
        {% endif %}

        {{ doc.datePublished }}.

        <br>

        {% if doc.about %}
        Subjects:
        <ul class="subjects" itemprop="about">
            {% for subject in doc.about %}
            <li itemprop="about">
                <a href="{{ subject.url }}">{{ subject.name }}</a>
            </li>
            {% if not forloop.last %} ; {% endif %}
            {% endfor %}
        </ul>
        <br>
        {% endif %}

        <ul itemprop="offers" class="offers">
          {% for offer in doc.offers %}
          <li class="offer" id="offer-{{ offer.serialNumber }}" itemtype="Offer" itemscope>
            <span class="itemType">
              {% if doc.type == "VideoObject" %}
              Video
              {% elif doc.type == "AudioObject" %}
              Audio
              {% elif doc.type == "WebPage" %}
              Website
              {% else %}
              {{ doc.type }}
              {% endif %}
            </span>
            <span itemprop="description"></span>
            <span itemprop="availabilityStarts"></span>
            <span itemprop="inventoryLevel"></span>:
            <span itemprop="seller">{{ offer.seller }}</span> 
            / 
            <span itemprop="availabilityAtOrFrom"></span>
            <span itemprop="sku"></span>
          </li>
          {% endfor %}
        </ul>

    </article>
    {% endfor %}

    </section>

    <section id="facets" class="span3 pull-right">

    <h2>Refine Results</h2>
    <h3>{{ search_results.totalResults|intcomma }} items</h3>
    <hr>

    {% for facet in search_results.facets %}
        <h2>{{ facet.name }}</h2>
        <ul>
            {% for f in facet.counts %}
            <li>
              <a href="{% url "search" %}?{{ f.url }}">{{ f.name }}</a>
              ({{ f.count|intcomma }})
            </li> 
            {% endfor %}
        </ul>
        <hr>
    {% endfor %}
    </section>

    </div>

    <section class="search row pagination">
        <form class="span12" action="{% url "search" %}" method="get">
            <input style="float: left; margin-right: 10px;" name="q" type="text" placeholder="Search" value="{{ q }}"></input>
            <ul>
                {% if prev_page_range %}
                <li><a href="{% url "search" %}?{{ prev_page_range }}">&#x00ab;</a></li>
                {% endif %}

                {% for n, q in page_range %}
                <li {% if n == page %}class="active"{% endif %}><a href="{% url "search" %}?{{q}}">{{ n }}</a></li>
                {% endfor %}

                {% if next_page_range %}
                <li><a href="{% url "search" %}?{{ next_page_range }}">&#x00bb;</a>
                {% endif %}
            </ul> 
        </form>
    </section>

    {% if debug %}
    <h2>Debugging info:</h2>
    JSON: <a href="{{ json_url }}">{{ json_url }}</a>
    &nbsp;
    Summon: <a href="{{ raw_url }}">{{ raw_url }}</a>
    <br>
    <br>
    {% endif %}


</div>

{% endblock %}
